<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Detail</title>
    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        .graph-container {
            display: flex;
            justify-content: center; /* Horizontally center the content */
            align-items: center; /* Vertically center the content */
            height: 320px; /* Make the container take up the full viewport height */
            width: 100%; /* Make the container take up the full width */
            position: relative; /* Ensure proper positioning */
        }

        .emotion-timeline {
            display: flex;
            justify-content: center; /* Horizontally center the chart */
            align-items: center; /* Vertically center the chart */
            width: 100%; /* Make the timeline occupy the full width */
            height: 100%; /* Make the timeline occupy 80% of the container's height */
            position: relative;
        }

        .spoiler-sticker {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%; /* ê·¸ë˜í”„ ì»¨í…Œì´ë„ˆì™€ ë™ì¼í•œ ë„ˆë¹„ */
            height: 100%; /* ê·¸ë˜í”„ ì»¨í…Œì´ë„ˆì™€ ë™ì¼í•œ ë†’ì´ */
            background-color: rgba(0, 0, 0, 0.8); /* ë°˜íˆ¬ëª… ë°°ê²½ */
            backdrop-filter: blur(10px); /* ë¸”ëŸ¬ íš¨ê³¼ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            text-align: center;
            z-index: 10;
        }
    
        .spoiler-sticker span {
            margin-bottom: 10px;
            color: #000; /* ë¸”ëŸ¬ ìœ„ì— í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            font-weight: bold;
        }
    
        .spoiler-sticker.hidden {
            display: none;
        }

        /* Container for checkboxes */
        #checkbox-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px; /* Increased gap for better spacing */
            flex-wrap: wrap; /* Allow the checkboxes to wrap if needed */
        }

        /* Style for each checkbox label */
        #checkbox-container label {
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px; /* Space between checkbox and label text */
            background-color: #f0f0f0; /* Light background to make checkboxes stand out */
            border-radius: 5px;
            padding: 8px 12px; /* Padding for more clickable area */
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        /* Style for checkbox itself */
        #checkbox-container input[type="checkbox"] {
            width: 20px; /* Increase size of checkbox */
            height: 20px;
            accent-color: #007bff; /* Custom color for checkbox */
            transition: transform 0.2s ease-in-out; /* Smooth animation for checked state */
        }

        /* Hover effect for checkboxes */
        #checkbox-container label:hover {
            background-color: #e0e0e0; /* Darker background on hover */
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2); /* Subtle shadow on hover */
        }

        /* Checked state style */
        #checkbox-container input[type="checkbox"]:checked {
            transform: scale(1.1); /* Slightly enlarge the checkbox when checked */
        }

        /* Label text customization */
        #checkbox-container label span {
            font-weight: bold; /* Bold label text */
            color: #333; /* Dark color for visibility */
        }

        /* Optional: Provide a nice visual feedback when the checkbox is checked */
        #checkbox-container input[type="checkbox"]:checked + span {
            color: #007bff; /* Change text color to blue when checked */
        }


        .video-details {
            margin-top: 20px;
        }

        .detail-card {
            margin-bottom: 20px;
        }

        .detail-card .card-content strong {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .emotion-timeline {
                height: 200px; /* ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ê·¸ë˜í”„ ë†’ì´ ì¡°ì • */
            }
        }
        .video-thumbnail {
            width: 100%; /* ë¶€ëª¨ ìš”ì†Œì˜ ë„ˆë¹„ì— ë§ê²Œ ì´ë¯¸ì§€ í¬ê¸° ì„¤ì • */
            height: 320px; /* ì´ë¯¸ì§€ì˜ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë„ë¡ ì„¤ì • */
            object-fit: contain; /* ì´ë¯¸ì§€ê°€ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©° ë¶€ëª¨ ìš”ì†Œì— ë§ê²Œ í¬ê¸°ê°€ ì¡°ì •ë˜ë„ë¡ ì„¤ì • */
        }

        .frame-wrapper {
        display: inline-block;
        margin: 10px;
        text-align: center;
        }

        .frame {
            width: 100px;  /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ì„¤ì • */
            height: auto;
        }

        .frame-text {
            margin-top: 5px;
            font-size: 14px;
            color: #333;
        }

        #frame-container {
            display: flex;
            flex-wrap: wrap;  /* Allow frames to wrap to the next line if needed */
            justify-content: center;  /* Horizontally center the frames */
            align-items: center;  /* Vertically center the frames */
            height: 100vh;  /* Take full viewport height */
            margin: 0 auto;  /* Center container horizontally */
        }

        /* ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .card {
            margin: 20px auto;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background: #fff;
        }

        /* ìš”ì•½ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .summary-section {
            background-color: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* ëŒ“ê¸€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .comment-section {
            padding: 10px;
        }

        .comment-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .comment-section li {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comment-section li:last-child {
            border-bottom: none;
        }

        /* ëŒ“ê¸€ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .comment-section li strong {
            font-size: 14px;
            color: #333;
        }

        /* ì¢‹ì•„ìš” ìŠ¤íƒ€ì¼ */
        .like-count {
            font-size: 12px;
            color: #888;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .card {
                width: 90%;
            }
        }
        
        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Background overlay */
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80%;
            margin: auto;
            display: block;
        }

        #modalCaption {
            text-align: center;
            color: #f1f1f1;
            font-size: 20px;
            margin-top: 10px;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        .nav-arrow {
            position: absolute;
            top: 50%;
            color: white;
            font-size: 40px;
            font-weight: bold;
            padding: 10px;
            cursor: pointer;
            z-index: 101;
        }

        #prevBtn {
            left: 10px;
            transform: translateY(-50%);
        }

        #nextBtn {
            right: 10px;
            transform: translateY(-50%);
        }

        .nav-arrow:hover {
            color: #bbb;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-wrapper blue">
            <a href="{% url 'emotion_tracker:index' %}" class="brand-logo center">Video Detail</a>
            <ul id="nav-mobile" class="left">
                <li><a href="javascript:void(0);" onclick="window.history.back();"><i class="material-icons">Back</i></a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <h4 class="center-align">Emotion Analysis</h4>

        
        
        <!-- Graph Container -->
        <div class="graph-container" style="position: relative;">
            <div class="emotion-timeline">
                <canvas id="emotionTimelineGraph"></canvas>
            </div>
            <!-- Spoiler Sticker -->
            <div class="spoiler-sticker" id="spoilerSticker">
                <button class="btn red waves-effect waves-light remove-spoiler-btn" id="removeSpoiler">
                    ìŠ¤í¬ ë°©ì§€ ì œê±°
                </button>
            </div>
        </div>

        <div id="checkbox-container">
            <label>
                <input type="checkbox" class="emotion-checkbox" data-emotion="0" checked>
                <span>Happy</span>
            </label>
            <label>
                <input type="checkbox" class="emotion-checkbox" data-emotion="1" checked>
                <span>Anger</span>
            </label>
            <label>
                <input type="checkbox" class="emotion-checkbox" data-emotion="2" checked>
                <span>Sadness</span>
            </label>
            <label>
                <input type="checkbox" class="emotion-checkbox" data-emotion="3" checked>
                <span>Panic</span>
            </label>
        </div>

        <!-- Video Details -->
        <div class="video-details">

            <a href="{{ video.video_url }}" target="_blank">
                <img src="{{ video.thumbnail_url }}" alt="Video Thumbnail" class="video-thumbnail" >
            </a> 

            <div class="card detail-card">
                <!-- ëŒ“ê¸€ ìš”ì•½ ì„¹ì…˜ -->
                <div class="card-content summary-section">
                    <strong>ìš”ì•½</strong>
                    <p id="comment-summary">ìš”ì•½ ì¤‘...</p>
                </div>
            </div>

            <!-- Title Card -->
            <div class="card detail-card">
                <div class="card-content">
                    <strong>ì œëª©</strong>
                    <a href="{{ video.video_url }}" target="_blank">{{ video.title }}</a>
                </div>
            </div>

            <!-- Description Card -->
            {% if video.description %}
                <div class="card detail-card">
                    <div class="card-content">
                        <strong>ì„¤ëª…</strong>
                        <p>{{ video.description }}</p>
                    </div>
                </div>
            {% endif %}
            
            <div id="comment-dev" style="display:none;">
                <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
                <div class="card comment-card">
                    <div class="card-content comment-section">
                        <strong>ëŒ“ê¸€</strong>
                        <ul id="comment-list">
                            <!-- ëŒ“ê¸€ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </ul>
                    </div>
                </div>
            </div>
            

            <!-- Emotion Info Card -->
            <div class="card detail-card">
                <div class="card-content">
                    <strong>ì±„ë„ëª…</strong>
                    <a href="{{ video.channel_url }}" target="_blank">{{ video.author }}</a>
                </div>
            </div>

            <!-- Upload Date Card -->
            <div class="card detail-card">
                <div class="card-content">
                    <strong>ë¶„ì„ ë‚ ì§œ</strong>
                    <span>{{ video.created_at|date:"Yë…„ mì›” dì¼, A gì‹œ ië¶„" }}</span>
                </div>
            </div>

            <!-- Additional Info Card -->
            <div class="card detail-card">
                <div class="card-content">
                    <strong>ê°ì •ì •ë³´</strong>
                    <p id="emotion-info">ê¸°ì¨ {{ video.happy }}ì  | í™”ë‚¨ {{ video.anger }}ì  | ìŠ¬í”” {{ video.sadness }}ì  | ë‹¹í™© {{ video.panic }}ì </p>
                </div>
            </div>

            <div id="frame-container"></div>
        </div>
    </div>

    <!-- Modal structure -->
    <div id="imageModal" class="modal" style="display:none;">
        <span id="closeModal" class="close">&times;</span>
        <img id="modalImage" class="modal-content" />
        <div id="modalCaption"></div>
        <!-- Left and Right arrow buttons for navigation -->
        <span id="prevBtn" class="nav-arrow">&#10094;</span>
        <span id="nextBtn" class="nav-arrow">&#10095;</span>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Chart.js for Timeline -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const frameContainer = document.getElementById('frame-container');
        const frames = JSON.parse('{{ frames|escapejs }}');
        const BASE_DIR = "{{ BASE_DIR }}"; 

        // Set to keep track of displayed frame numbers
        const displayedFrameNumbers = new Set();
        frames.forEach((frame, i) => {
                
            // Check if the frame number has already been displayed
            if (displayedFrameNumbers.has(frame.frame_number)) {
                return;  // Skip if the frame number has already been displayed
            }

            // Mark the frame number as displayed
            displayedFrameNumbers.add(frame.frame_number);
            
            // í”„ë ˆì„ ì»¨í…Œì´ë„ˆ ìƒì„±
            const frameWrapper = document.createElement('div');
            frameWrapper.className = 'frame-wrapper';

            // ì´ë¯¸ì§€ ìƒì„±
            const img = document.createElement('img');
            img.src = `${BASE_DIR}${frame.frame_filename}`;  // ê²½ë¡œë¥¼ ìˆ˜ì •í•  í•„ìš”ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            img.className = 'frame';
            frameWrapper.appendChild(img);

            // A íƒœê·¸ë¡œ ê°ì‹¸ê¸°
            // const link = document.createElement('a');
            // link.href = `${BASE_DIR}${frame.frame_filename}`;  // ì´ë¯¸ì§€ ë§í¬
            // link.target = '_blank';  // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
            // link.appendChild(img);  // ì´ë¯¸ì§€ íƒœê·¸ë¥¼ A íƒœê·¸ì— ì¶”ê°€

            // frameWrapper.appendChild(link);  // A íƒœê·¸ë¥¼ í”„ë ˆì„ ë˜í¼ì— ì¶”ê°€

            // ì´ë¯¸ì§€ ì•„ë˜ í…ìŠ¤íŠ¸ ìƒì„±
            const text = document.createElement('p');
            text.className = 'frame-text';
            text.textContent = `Frame ${frame.frame_number}`;  // í”„ë ˆì„ ë²ˆí˜¸ í‘œì‹œ
            frameWrapper.appendChild(text);  // í…ìŠ¤íŠ¸ ì¶”ê°€

            // í”„ë ˆì„ ì»¨í…Œì´ë„ˆë¥¼ ì „ì²´ í”„ë ˆì„ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
            frameContainer.appendChild(frameWrapper);

            // Open the image in modal on click
            img.addEventListener('click', function() {
                const modal = document.getElementById('imageModal');
                const modalImage = document.getElementById('modalImage');
                const modalCaption = document.getElementById('modalCaption');

                // Set the modal image to the clicked image
                modalImage.src = img.src;
                modalCaption.textContent = `Frame ${frame.frame_number}`; // Optionally, add a caption
                currentImageIndex = i; // Set the current image index

                window.addEventListener('scroll', handleScrollCloseModal); // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

                // Show the modal
                modal.style.display = 'block';
            });
        });

        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ëª¨ë‹¬ ë‹«ê¸°
        function handleScrollCloseModal() {
            const scrollThreshold = 500; // ê¸°ì¤€ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ (px)
            if (window.scrollY < scrollThreshold) {
                closeImageModal();
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            window.removeEventListener('scroll', handleScrollCloseModal); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
        }

        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('closeModal').addEventListener('click', closeImageModal);

        // Handle previous navigation
        document.getElementById('prevBtn').addEventListener('click', function() {
            // Move backwards until a different filename is found
            do {
                if (currentImageIndex <= 0) break;  // Stop if at the first image
                currentImageIndex--;
            } while (frames[currentImageIndex].frame_filename === frames[currentImageIndex + 1].frame_filename);

            // Update the modal image and caption
            const modalImage = document.getElementById('modalImage');
            modalImage.src = `${BASE_DIR}${frames[currentImageIndex].frame_filename}`;
            const modalCaption = document.getElementById('modalCaption');
            modalCaption.textContent = `Frame ${frames[currentImageIndex].frame_number}`;
        });

        // Handle next navigation
        document.getElementById('nextBtn').addEventListener('click', function() {
            // Move forwards until a different filename is found
            do {
                if (currentImageIndex >= frames.length - 1) break;  // Stop if at the last image
                currentImageIndex++;
            } while (frames[currentImageIndex].frame_filename === frames[currentImageIndex - 1].frame_filename);

            // Update the modal image and caption
            const modalImage = document.getElementById('modalImage');
            modalImage.src = `${BASE_DIR}${frames[currentImageIndex].frame_filename}`;
            const modalCaption = document.getElementById('modalCaption');
            modalCaption.textContent = `Frame ${frames[currentImageIndex].frame_number}`;
        });

        // Keyboard navigation (left/right arrow keys)
        window.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                    // Move backwards until a different filename is found
                do {
                    if (currentImageIndex <= 0) break;  // Stop if at the first image
                    currentImageIndex--;
                } while (frames[currentImageIndex].frame_filename === frames[currentImageIndex + 1].frame_filename);

                // Update the modal image and caption
                const modalImage = document.getElementById('modalImage');
                modalImage.src = `${BASE_DIR}${frames[currentImageIndex].frame_filename}`;
                const modalCaption = document.getElementById('modalCaption');
                modalCaption.textContent = `Frame ${frames[currentImageIndex].frame_number}`;
            } else if (event.key === 'ArrowRight') {
                    do {
                    if (currentImageIndex >= frames.length - 1) break;  // Stop if at the last image
                    currentImageIndex++;
                } while (frames[currentImageIndex].frame_filename === frames[currentImageIndex - 1].frame_filename);

                // Update the modal image and caption
                const modalImage = document.getElementById('modalImage');
                modalImage.src = `${BASE_DIR}${frames[currentImageIndex].frame_filename}`;
                const modalCaption = document.getElementById('modalCaption');
                modalCaption.textContent = `Frame ${frames[currentImageIndex].frame_number}`;
            } else if (event.key === 'Escape') {
                closeImageModal();
            }
        });


        // ìŠ¤í¬ ë°©ì§€ ìŠ¤í‹°ì»¤ ì œê±° ê¸°ëŠ¥
        const spoilerSticker = document.getElementById('spoilerSticker');
        const removeSpoilerButton = document.getElementById('removeSpoiler');

        removeSpoilerButton.addEventListener('click', () => {
            spoilerSticker.classList.add('hidden');
        });

        /// Emotion Timeline Graph (ì˜ˆì‹œ ë°ì´í„°)
        const ctx = document.getElementById('emotionTimelineGraph').getContext('2d');

        // Emotion class labels
        const emotionClasses = ['Happy', 'Anger', 'Sadness', 'Panic'];

        console.log(frames);

        // Initialize the data for each emotion class
        const emotionData = {
            labels: [],  // Frame numbers will be added here
            datasets: [
                { label: 'Happy', data: [], borderColor: 'blue', backgroundColor: 'rgba(0, 0, 255, 0.1)', fill: true },
                { label: 'Anger', data: [], borderColor: 'red', backgroundColor: 'rgba(255, 0, 0, 0.1)', fill: true },
                { label: 'Sadness', data: [], borderColor: 'gray', backgroundColor: 'rgba(125, 125, 125, 0.1)', fill: true },
                { label: 'Panic', data: [], borderColor: 'green', backgroundColor: 'rgba(0, 255, 0, 0.1)', fill: true }
            ]
        };

        frames.forEach(frame => {
            // If confidence is -1, treat it as 0
            const confidence = frame.confidence === -1 ? 0 : frame.confidence;
            
            // If detection_class is missing or invalid, default it to 0 (Joy)
            const detectionClass = frame.detection_class >= 0 && frame.detection_class < 4
                ? frame.detection_class
                : 0; // Default to Joy if invalid or missing

            // Add the frame number to labels only once
            if (!emotionData.labels.includes(`Frame ${frame.frame_number}`)) {
                emotionData.labels.push(`Frame ${frame.frame_number}`);  // Add frame number to the labels only once
            }

            // Ensure all emotion classes (0 to 3) are represented for each frame
            for (let i = 0; i < emotionData.datasets.length; i++) {
                const frameIndex = emotionData.labels.indexOf(`Frame ${frame.frame_number}`);

                if (i === detectionClass) {
                    // If this class for this frame already has a confidence, update with the higher value
                    if (emotionData.datasets[i].data[frameIndex] === undefined) {
                        emotionData.datasets[i].data.push(confidence * 10);  // First time setting the confidence
                    } else {
                        // If a value already exists, take the maximum between the existing and the new confidence
                        emotionData.datasets[i].data[frameIndex] = Math.max(emotionData.datasets[i].data[frameIndex], confidence * 10);
                    }
                } else {
                    // If this class does not match, push 0 as the confidence for this class
                    if (emotionData.datasets[i].data[frameIndex] === undefined) {
                        emotionData.datasets[i].data.push(0);  // If no confidence value exists, set to 0
                    }
                }
            }
        });


        // Create the chart
        const chart = new Chart(ctx, {
            type: 'line',
            data: emotionData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Time'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Confidence Score'
                        },
                        min: 0,  // Minimum value for y-axis
                        max: 10   // Maximum value for y-axis (as confidence is between 0 and 1)
                    }
                }
            }
        });

        // Add event listener to checkboxes
        const checkboxes = document.querySelectorAll('.emotion-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (event) => {
                const emotionIndex = event.target.dataset.emotion;
                chart.data.datasets[emotionIndex].hidden = !event.target.checked; // Toggle visibility
                chart.update(); // Re-render the chart
            });
        });

        const comments = JSON.parse('{{ comments|escapejs }}');
        const videoTitle = '{{ video.title }}';
        console.log(comments);
        // ëŒ“ê¸€ ëª©ë¡ ì¶”ê°€
        const commentList = document.getElementById('comment-list');

        let comments_for_prompt = '';

        comments.forEach(comment => {
            document.getElementById('comment-dev').style.display = 'block'
            const li = document.createElement('li');

            // ëŒ“ê¸€ ë³¸ë¬¸
            const commentText = document.createElement('span');
            commentText.innerHTML = `<strong>${comment.author}</strong>: ${comment.text}`;
            comments_for_prompt += `, ${comment.text}`;
            // ì¢‹ì•„ìš” í‘œì‹œ
            const likes = document.createElement('span');
            likes.className = 'like-count';
            likes.textContent = `ğŸ‘ ${comment.likes}`;

            li.appendChild(commentText);
            li.appendChild(likes);
            commentList.appendChild(li);
        });

        const apiKey = "AIzaSyBOSSGyQnVIG8uR746dfGKxbPTv3vmLdSA"; // Replace with your API key
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
        
        const emotionText = document.getElementById("emotion-info").textContent;

        // ê¹”ë”í•˜ê²Œ ì´ë™ì§„ í‰ë¡ ê°€ì²˜ëŸ¼ í•œì¤„ë¡œë§Œ ë‹µë³€í•´ì¤˜
        const prompt = `ìœ íŠœë¸Œ ì œëª©, ëŒ“ê¸€ ì¸ê¸°ìˆœ 5ê°œ, ê°ì •ìˆ˜ì¹˜ì¸ë°,
        ê°ì •ìˆ˜ì¹˜ëŠ” ì°¸ê³ ë§Œ í•˜ê³ ,
        ì œëª©ê³¼ ëŒ“ê¸€ì—ì„œ í‚¤ì›Œë“œ ë‹¨ì–´ 5ê°œë§Œ ë½‘ì•„ì„œ ë‹µë³€í•´ì¤˜ ê·¸ë¦¬ê³  í•œì¤„ ë„ì–´ì„œ ê¹”ë”í•˜ê²Œ ì´ë™ì§„ í‰ë¡ ê°€ì²˜ëŸ¼ í•œì¤„ë¡œë§Œ ë‹µë³€í•´ì¤˜
        ëŒ“ê¸€ì´ ì—†ìœ¼ë©´, ì œëª©ë§Œ ì°¸ê³ í•´ì„œ í‚¤ì›Œë“œ ë‹¨ì–´ì™€ í•œì¤„í‰ì„ ë‹µë³€í•´ì£¼ë©´ ë¼
        ëŒ“ê¸€(ë“¤)ì´ë¼ëŠ” ë§ê³¼ ì˜í™”ë¼ëŠ” ë§ì€ ì œì™¸í•´ì¤˜ 
        ì œëª©: ${videoTitle}
        ëŒ“ê¸€: ${comments_for_prompt}
        ê°ì •ìˆ˜ì¹˜: ${emotionText}
        ì˜ˆì‹œ : 
        ê²°í˜¼, ì„±ê³µ, ìŠµê´€, ì†ë†€ë¦¼, ê·€ì—¬ì›€
        ê²°í˜¼ì˜ ê¸°ìˆ , ìŠµê´€ì˜ ìŠ¹ë¦¬, ë†€ë¼ìš´ ì†ì¬ì£¼, ìˆœìˆ˜í•¨ê³¼ ë§¤ë ¥ì˜ ì¡°í™”.
        `;

        // Construct the request body
        const requestBody = {
            contents: [
                {
                    parts: [{ text: prompt }]
                }
            ]
        };

        async function fetchSummary() {
            try {
                // Make the API request
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(requestBody)
                });

                // Handle the response
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP Error: ${response.status}\n${errorText}`);
                }

                const result = await response.json();

                console.log(JSON.stringify(result, null, 2));
                
                // Extracting the summary text from the API response
                const text = result.candidates[0].content.parts[0].text;

                // Update the summary on the page
                const commentSummary = document.getElementById('comment-summary');
                // commentSummary.textContent = text;  // Update the summary text
                // Replace \n with <br> for line breaks in HTML
                const formattedText = text.replace(/\n/g, '<br>');

                // Update the summary text with formatted HTML
                commentSummary.innerHTML = formattedText;
                
            } catch (error) {
                console.error("Error:", error);
                const commentSummary = document.getElementById('comment-summary');
                commentSummary.textContent = `Error: ${error.message}`;  // Show error message if something goes wrong
            }
        }
        fetchSummary();
    </script>
</body>
</html>
